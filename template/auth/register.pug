extends ../navbar

block title
    title Turbo - Register

block main
    br
    h1(style="text-align: center;") Register
    br
    .uk-flex.uk-flex-center
        .uk-card.uk-card-default.uk-card-body(style="")
            form
                .uk-margin
                    .uk-inline
                        span.uk-form-icon(uk-icon="icon: user")
                        input.uk-input(type="text", placeholder="username", id="username")
                .uk-margin
                    .uk-inline
                        span.uk-form-icon(uk-icon="icon: lock")
                        input.uk-input(type="password", placeholder="password", id="password")
                .uk-margin
                    .uk-inline
                        span.uk-form-icon(uk-icon="icon: mail")
                        input.uk-input(type="text", placeholder="email", id="email")
                button.uk-button.uk-button-default.uk-width-1-1.uk-button-primary(onclick="register()", id="registerButton") Register

    script.
        function register() {
            NProgress.start()
            document.getElementById("registerButton").setAttribute("disabled", true)

            axios.post('/auth/register', data = {
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value,
                    email: document.getElementById('email').value
                })
                .then(function(data) {
                    NProgress.done()
                    document.getElementById("registerButton").removeAttribute("disabled")
                    UIkit.notification("Register success! Redirecting")
                    setTimeout(function() {
                        window.location.href = "/auth/login"
                    }, 1000)
                })
                .catch(function(error) {
                    NProgress.done()
                    if (error.response) {
                        if (error.response.status >= 500) {
                            UIkit.notification("Internal Server Error", {status: 'warning'})
                        } else {
                            var messages = []

                            for (var message in error.response.data.message) {
                                message = error.response.data.message[message]
                                messages.push(message.message)
                            }

                            UIkit.notification(messages.join('<br />'), {status: 'danger'})
                        }
                    }
                    document.getElementById("registerButton").removeAttribute("disabled")
                })
        }
